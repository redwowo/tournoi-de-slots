<!DOCTYPE html>
<html lang="fr" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tournoi 16 joueurs - Suivi des √©liminations</title>
    <style>
        :root {
            --bg-color: #f8f9fa;
            --text-color: #333;
            --card-bg: #fff;
            --border-color: #e2e8f0;
            --item-bg: #f8f9fa;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --btn-bg: #333;
            --btn-text: white;
            --btn-hover: #000;
            --btn-disabled: #888;
            --eliminated-color: red;
            --victory-bg: gold;
            --overlay-bg: rgba(0, 0, 0, 0.8);
            --heading-color: #1e293b;
            --muted-text: #666;
            --success-color: #10b981;
            --success-bg: #d1fae5;
            --success-text: #065f46;
            --toast-bg: rgba(255, 255, 255, 0.95);
            --toast-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            --toast-error-bg: #fee2e2;
            --toast-error-border: #ef4444;
            --toast-success-bg: #dcfce7;
            --toast-success-border: #10b981;
            --warning-color: #f59e0b;
            --warning-bg: #fef3c7;
            --warning-text: #92400e;
        }

        .dark {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --card-bg: #2a2a2a;
            --border-color: #444;
            --item-bg: #333;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --btn-bg: #555;
            --btn-text: #e0e0e0;
            --btn-hover: #777;
            --btn-disabled: #444;
            --eliminated-color: #ff6b6b;
            --victory-bg: #ffd700;
            --overlay-bg: rgba(0, 0, 0, 0.9);
            --heading-color: #e0e0e0;
            --muted-text: #aaa;
            --success-color: #34d399;
            --success-bg: rgba(16, 185, 129, 0.2);
            --success-text: #d1fae5;
            --toast-bg: rgba(26, 26, 26, 0.95);
            --toast-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            --toast-error-bg: rgba(239, 68, 68, 0.2);
            --toast-error-border: #ef4444;
            --toast-success-bg: rgba(16, 185, 129, 0.2);
            --toast-success-border: #10b981;
            --warning-color: #fbbf24;
            --warning-bg: rgba(245, 158, 11, 0.2);
            --warning-text: #fef3c7;
        }

        body { 
            font-family: Arial, sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-color);
            margin: 0;
            padding: 1rem;
            width: 100%;
            max-width: 100%;
            overflow-x: hidden;
            min-height: 100vh;
            box-sizing: border-box;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .main-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 2rem;
            margin-top: 1.5rem;
            max-width: 1400px; /* Increased from 1200px */
            margin-left: auto;
            margin-right: auto;
            padding: 0 1rem;
        }

        /* Sidebar √† gauche */
        .sidebar { 
            width: 300px; 
            background: var(--card-bg); 
            color: var(--text-color);
            padding: 1rem; 
            border-radius: 0.5rem; 
            box-shadow: 0 2px 10px var(--shadow-color);
            text-align: center;
            position: sticky;
            top: 1rem;
            transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
        }

        .sidebar h3 { 
            margin-bottom: 0.75rem; 
            text-align: center; 
            color: var(--text-color);
        }

        .sidebar ul { 
            list-style: none; 
            padding: 0; 
            text-align: left;
            margin-bottom: 1rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .sidebar li { 
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            background-color: var(--item-bg);
            transition: background-color 0.3s ease;
        }

        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .remove-btn {
            background: none;
            border: none;
            color: #ef4444;
            cursor: pointer;
            font-size: 1rem;
            padding: 0.25rem;
            margin-left: 0.5rem;
            transition: transform 0.2s;
        }

       @keyframes smoothPulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.15); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        .remove-btn:hover {
            animation: smoothPulse 0.4s ease-in-out;
            color: #dc2626; /* Rouge un peu plus fonc√© */
        }

	.remove-btn img {
    	    width: 16px;
    	    height: 16px;
    	    vertical-align: middle;
	}

        /* Bracket √† droite */
        .bracket { 
            display: flex;  
            gap: 2rem; /* Reduced from 2.5rem to save space */
            overflow-x: auto;
            padding-bottom: 1rem;
            width: 100%;
            position: relative;
        }

        .round { 
            display: flex; 
            flex-direction: column;
            position: relative;
            min-width: 180px; /* Reduced from 220px */
            z-index: 1;
        }

        .round h3 {
            text-align: center;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--text-color);
        }

        .match-wrapper {
            position: relative;
            margin-bottom: 2rem;
        }

        .match { 
            border: 1px solid var(--border-color); 
            padding: 0.5rem; /* Reduced from 0.75rem */
            display: flex; 
            flex-direction: column; 
            gap: 0.25rem; /* Reduced from 0.5rem */
            border-radius: 0.5rem; 
            background: var(--card-bg); 
            box-shadow: 0 2px 8px var(--shadow-color);
            position: relative;
            z-index: 2;
            transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            min-width: 150px; /* Added to ensure minimum width */
            max-width: 220px; /* Added to limit maximum width */
        }

        .player-btn { 
            padding: 0.4rem; /* Reduced from 0.5rem */
            cursor: pointer; 
            background: var(--btn-bg); 
            color: var(--btn-text); 
            border: none; 
            border-radius: 0.25rem; 
            font-weight: 500;
            width: 100%;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            font-size: 0.9rem; /* Added to make text slightly smaller */
        }

        .player-btn:hover { 
            background: var(--btn-hover); 
        }

        .player-btn:disabled {
            background: var(--btn-disabled);
            cursor: not-allowed;
        }

        .player-btn.winner {
            background: var(--success-bg);
            color: var(--success-text);
            border: 1px solid var(--success-color);
        }

        .player-btn.waiting {
            background: var(--btn-disabled);
            cursor: not-allowed;
        }

        .player-btn.waiting::after {
            content: "En attente d'adversaire";
            position: absolute;
            bottom: -25px;
            left: 0;
            right: 0;
            font-size: 0.7rem;
            color: var(--muted-text);
            font-style: italic;
        }

        .eliminated { 
            text-decoration: line-through; 
            color: var(--eliminated-color); 
            transition: all 0.3s ease;
        }

        .checkmark {
            display: inline-block;
            margin-left: 5px;
            color: var(--success-color);
        }

        input { 
            padding: 0.75rem; 
            width: 100%;
            margin-bottom: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 0.25rem;
            box-sizing: border-box;
            font-size: 0.9rem;
            background-color: var(--card-bg);
            color: var(--text-color);
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }

        button { 
            padding: 0.75rem;
            background: var(--btn-bg);
            color: var(--btn-text);
            border: none;
            border-radius: 0.25rem;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
            font-size: 0.9rem;
        }

        button:hover {
            background: var(--btn-hover);
        }

        button:disabled {
            background: var(--btn-disabled);
            cursor: not-allowed;
        }

        .btn-outline {
            background: var(--card-bg);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        .btn-outline:hover {
            background: var(--item-bg);
        }

        .btn-add {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            width: 100%;
            margin-bottom: 1rem;
        }

        #victoryMessage {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            text-align: center;
            font-size: 1.5rem;
            font-weight: bold;
            padding: 1.5rem;
            background: var(--victory-bg);
            color: #000; /* Always keep text dark on gold background */
            border-radius: 0.5rem;
            box-shadow: 0 4px 12px var(--shadow-color);
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translate(-50%, -60%); }
            to { opacity: 1; transform: translate(-50%, -50%); }
        }

        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9998;
            display: none;
            background: var(--overlay-bg);
        }

        h1 {
            text-align: center;
            font-size: 2rem;
            font-weight: bold;
            margin-top: 1.25rem;
            color: var(--heading-color);
            transition: color 0.3s ease;
        }

        .trophy-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            display: block;
        }

        .add-icon, .shuffle-icon {
            margin-right: 0.25rem;
            font-size: 1.1rem;
        }

        .input-container {
            margin-bottom: 0.5rem;
        }

        .divider {
            height: 1px;
            background-color: var(--border-color);
            margin: 1rem 0;
            width: 100%;
            transition: background-color 0.3s ease;
        }

        .match-info {
            font-size: 0.8rem;
            color: var(--muted-text);
            text-align: center;
            margin-top: 0.5rem;
            font-style: italic;
            transition: color 0.3s ease;
        }

        /* Theme toggle button */
        .theme-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            background: var(--btn-bg);
            color: var(--btn-text);
            border: none;
            border-radius: 50%;
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 2px 5px var(--shadow-color);
            transition: background-color 0.3s ease;
        }

        .theme-toggle:hover {
            background: var(--btn-hover);
        }

	.theme-toggle img {
    	    width: 20px;
    	    height: 20px;
	}

        /* Toast notifications */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }

        .toast {
            padding: 12px 16px;
            border-radius: 6px;
            background: var(--toast-bg);
            box-shadow: var(--toast-shadow);
            display: flex;
            flex-direction: column;
            animation: slideIn 0.3s ease-out;
            transition: transform 0.3s ease, opacity 0.3s ease;
            border-left: 4px solid transparent;
        }

        .toast.error {
            background: var(--toast-error-bg);
            border-left-color: var(--toast-error-border);
        }

        .toast.success {
            background: var(--toast-success-bg);
            border-left-color: var(--toast-success-border);
        }

        .toast.warning {
            background: var(--warning-bg);
            border-left-color: var(--warning-color);
        }

        .toast-title {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .toast-message {
            font-size: 0.9rem;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        /* Elimination history modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
        }

        .modal-overlay {
            position: absolute;
            width: 100%;
            height: 100%;
            background: var(--overlay-bg);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 12px var(--shadow-color);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            margin-bottom: 1rem;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .modal-description {
            color: var(--muted-text);
            font-size: 0.9rem;
        }

        .modal-body {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 1rem;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
        }

        .elimination-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .elimination-item {
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 0.25rem;
            margin-bottom: 0.75rem;
        }

        .elimination-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .eliminated-player {
            font-weight: bold;
            color: var(--eliminated-color);
        }

        .elimination-round {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            background: var(--item-bg);
            border-radius: 0.25rem;
        }

        .elimination-details {
            font-size: 0.9rem;
            color: var(--muted-text);
        }

        .elimination-time {
            font-size: 0.8rem;
            color: var(--muted-text);
            margin-top: 0.5rem;
        }

        .badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 500;
            border-radius: 9999px;
            background: var(--item-bg);
            position: absolute;
            top: -8px;
            right: -8px;
        }

        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
                align-items: center;
                gap: 1.5rem;
            }

            .sidebar {
                width: 100%;
                position: static;
                max-width: 100%;
            }

            .bracket {
                flex-direction: column;
                align-items: center;
                gap: 2rem;
            }

            .round {
                width: 100%;
                align-items: center;
            }

            .match-wrapper {
                width: 100%;
                max-width: 300px;
            }

            .connector {
                display: none;
            }

            h1 {
                font-size: 1.5rem;
            }
            
            .player-btn.waiting::after {
                position: static;
                display: block;
                margin-top: 0.25rem;
            }

            .theme-toggle {
                top: 0.5rem;
                right: 0.5rem;
            }

            .modal-content {
                width: 95%;
                max-height: 90vh;
            }
        }

        .input-error {
            border: 2px solid #ef4444;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        /* Confirmation dialog */
        .confirm-dialog {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 12px var(--shadow-color);
            z-index: 9999;
            max-width: 400px;
            width: 90%;
        }

        .confirm-dialog-title {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .confirm-dialog-message {
            margin-bottom: 1.5rem;
            color: var(--text-color);
        }

        .confirm-dialog-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }

        .btn-danger {
            background-color: #ef4444;
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

        /* Reset dialog */
        .reset-dialog {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--card-bg);
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 12px var(--shadow-color);
            z-index: 9999;
            max-width: 400px;
            width: 90%;
        }

        .reset-dialog-title {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .reset-dialog-message {
            margin-bottom: 1.5rem;
            color: var(--text-color);
        }

        .reset-dialog-buttons {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .shuffle-icon {
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .dice-icon {
            width: 18px; /* Ajustable selon la taille souhait√©e */
            height: 18px;
	    position: relative;
	    top: 4px;
        }

	#launchDraw {
    	    padding-top: 12px;  /* Augmente ou diminue pour √©quilibrer */
    	    padding-bottom: 12px;
	    line-height: 1.6;
	}

/* Panneau des r√©sultats pr√©c√©dents */
.previous-winners-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    width: 100%;
    margin-top: 1rem;
    background-color: var(--card-bg);
    color: var(--text-color);
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    padding: 0.75rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

.previous-winners-btn:hover {
    background-color: var(--item-bg);
}

.previous-winners-btn .trophy-icon {
    color: gold;
    font-size: 1.25rem;
    margin: 0;
    display: inline;
}

/* Modal des gagnants pr√©c√©dents */
.winners-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 9999;
}

.winners-modal-overlay {
    position: absolute;
    width: 100%;
    height: 100%;
    background: var(--overlay-bg);
}

.winners-modal-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--card-bg);
    padding: 2rem;
    border-radius: 0.75rem;
    box-shadow: 0 8px 24px var(--shadow-color);
    max-width: 700px;
    width: 90%;
    max-height: 80vh;
    display: flex;
    flex-direction: column;
}

.winners-modal-header {
    display: flex;
    align-items: center;
    margin-bottom: 1.5rem;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 1rem;
}

.winners-modal-title {
    font-size: 1.5rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.winners-modal-title .trophy-icon {
    color: gold;
    font-size: 1.75rem;
    margin: 0;
    display: inline;
}

.winners-modal-description {
    color: var(--muted-text);
    font-size: 1rem;
    margin-top: 0.5rem;
}

.winners-modal-body {
    flex: 1;
    overflow-y: auto;
    margin-bottom: 1.5rem;
}

.winners-modal-footer {
    display: flex;
    justify-content: flex-end;
    border-top: 1px solid var(--border-color);
    padding-top: 1rem;
}

.winners-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 1rem;
}

.winner-item {
    display: flex;
    align-items: center;
    padding: 1rem;
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    background-color: var(--item-bg);
    transition: background-color 0.3s ease, transform 0.2s ease;
}

.winner-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px var(--shadow-color);
}

.winner-trophy {
    margin-right: 0.75rem;
    color: gold;
    font-size: 1.5rem;
}

.winner-info {
    flex: 1;
    text-align: left;
}

.winner-name {
    font-weight: bold;
    margin-bottom: 0.25rem;
    font-size: 1.1rem;
}

.winner-date {
    font-size: 0.85rem;
    color: var(--muted-text);
}

.no-winners {
    padding: 2rem;
    color: var(--muted-text);
    font-style: italic;
    text-align: center;
    font-size: 1.1rem;
    background-color: var(--item-bg);
    border-radius: 0.5rem;
    border: 1px dashed var(--border-color);
}

/* Bouton d'annulation de match */
.undo-match-btn {
    background-color: var(--warning-color);
    color: white;
    border: none;
    border-radius: 0.25rem;
    padding: 0.4rem 0.6rem;
    font-size: 0.8rem;
    cursor: pointer;
    margin-top: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.25rem;
    transition: background-color 0.2s ease;
}

.undo-match-btn:hover {
    background-color: #e69009;
}

.undo-match-btn:disabled {
    background-color: #d1d5db;
    cursor: not-allowed;
}

.undo-icon {
    width: 14px;
    height: 14px;
    display: inline-block;
}

/* Confirmation d'annulation */
.undo-confirm-dialog {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: var(--card-bg);
    padding: 1.5rem;
    border-radius: 0.5rem;
    box-shadow: 0 4px 12px var(--shadow-color);
    z-index: 9999;
    max-width: 450px;
    width: 90%;
}

.undo-confirm-title {
    font-size: 1.25rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
    color: var(--warning-color);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.undo-confirm-message {
    margin-bottom: 1.5rem;
    color: var(--text-color);
    line-height: 1.5;
}

.undo-confirm-buttons {
    display: flex;
    justify-content: flex-end;
    gap: 0.75rem;
}

.btn-warning {
    background-color: var(--warning-color);
}

.btn-warning:hover {
    background-color: #e69009;
}

.score-inputs {
    display: flex;
    gap: 0.25rem;
    margin-top: 0.25rem;
    margin-bottom: 0.25rem;
    justify-content: center;
}

.score-inputs input {
    padding: 0.25rem;
    width: 40px;
    font-size: 0.85rem;
    text-align: center;
    margin-bottom: 0;
}

.score-separator {
    display: flex;
    align-items: center;
    color: var(--muted-text);
}

.score-display {
    font-size: 0.9rem;
    color: var(--muted-text);
    text-align: center;
    margin-top: 0.5rem;
}

.score-note {
    font-size: 0.75rem;
    color: var(--muted-text);
    text-align: center;
    margin-top: 0.25rem;
    margin-bottom: 0.25rem;
    font-style: italic;
}

.score-box {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 0.25rem;
    margin-bottom: 0.25rem;
    background-color: var(--item-bg);
    border-radius: 0.25rem;
    padding: 0.15rem 0.5rem;
    border: 1px solid var(--border-color);
}

.score-box-label {
    font-size: 0.8rem;
    color: var(--muted-text);
    margin-bottom: 0.25rem;
}

.score-box-value {
    display: flex;
    gap: 0.5rem;
    font-size: 0.9rem;
    font-weight: bold;
}

    </style>
</head>
<body>
    <!-- Theme toggle button -->
    <button class="theme-toggle" id="themeToggle" aria-label="Changer de th√®me">üåì</button>

    <!-- Titre -->
    <h1>
        <img src="./sept.png" alt="Slot Machine" width="32" height="32">
        Tournoi de Slots
        <img src="./sept.png" alt="Slot Machine" width="32" height="32">
    </h1>

    <!-- Conteneur principal -->
    <div class="main-container">

        <!-- Sidebar gauche -->
        <div class="sidebar">
            <h3>üë• Participants :</h3>
            <ul id="playersDisplay"></ul>
            
            <div class="divider"></div>
            
            <div id="addPlayerContainer" class="input-container">
                <input type="text" id="playerName" placeholder="‚úçÔ∏è Nom de la machine">
                <button id="addPlayerBtn" onclick="addPlayer()" class="btn-add">
                    <span class="add-icon">
    			<img src="./slot.png" 
         		alt="Slot Machine" width="20" height="20">
		    </span> 
		    Ajouter la Slot
                </button>
            </div>
            
            <p id="count">Joueurs ajout√©s : 0/16</p>
            
            <button id="launchDraw" onclick="launchDraw()" style="display: none; width: 100%;">
                <span class="shuffle-icon">
    		<img src="./de.png" 
         	alt="D√©" class="dice-icon">
		</span> 
		Lancer le tirage
            </button>
            
            <button id="resetButton" onclick="showResetConfirmDialog()" class="btn-outline" style="display: none; width: 100%; margin-top: 1rem;">
                R√©initialiser le tournoi
            </button>
            
            <!-- Bouton d'historique des √©liminations -->
            <button id="eliminationHistoryBtn" onclick="showEliminationHistory()" class="btn-outline" style="display: none; width: 100%; margin-top: 1rem;">
                <span style="margin-right: 0.5rem;">üìã</span> Historique des √©liminations
            </button>
            
            <!-- Bouton pour effacer toutes les donn√©es -->
            <button id="clearDataBtn" onclick="showConfirmDialog('Effacer toutes les donn√©es', '√ätes-vous s√ªr de vouloir effacer toutes les donn√©es ? Cette action est irr√©versible.', clearAllData)" class="btn-outline" style="width: 100%; margin-top: 1rem;">
                <img src="./poubelle.png" alt="Poubelle" width="16" height="16" style="margin-right: 0.5rem;"> Effacer toutes les donn√©es
            </button>
            
            <!-- Bouton pour afficher les r√©sultats des tournois pr√©c√©dents -->
            <button id="showPreviousWinnersBtn" onclick="toggleWinnersPanel()" class="previous-winners-btn">
                <span class="trophy-icon">üèÜ</span> R√©sultats tournois pr√©c√©dents
            </button>
        </div>

        <!-- Tableau de tournoi √† droite -->
        <div class="bracket" id="bracket" style="display: none;"></div>
    </div>

    <!-- Overlay et message de victoire -->
    <div id="overlay"></div>
    <div id="victoryMessage">
        <span class="trophy-icon">üèÜ</span>
        <p id="winnerText"></p>
        <button onclick="closeVictoryMessage()" style="margin-top: 1rem;">Fermer</button>
    </div>
    
    <!-- Toast container -->
    <div class="toast-container" id="toastContainer"></div>
    
    <!-- Confirmation dialog -->
    <div class="confirm-dialog" id="confirmDialog">
        <div class="confirm-dialog-title" id="confirmDialogTitle"></div>
        <div class="confirm-dialog-message" id="confirmDialogMessage"></div>
        <div class="confirm-dialog-buttons">
            <button class="btn-outline" onclick="closeConfirmDialog()">Annuler</button>
            <button class="btn-danger" id="confirmDialogConfirmBtn">Confirmer</button>
        </div>
    </div>
    
    <!-- Reset dialog -->
    <div class="reset-dialog" id="resetDialog">
        <div class="reset-dialog-title">R√©initialiser le tournoi</div>
        <div class="reset-dialog-message">Comment souhaitez-vous r√©initialiser le tournoi ?</div>
        <div class="reset-dialog-buttons">
            <button onclick="resetTournamentWithOption(true)">Conserver la liste des joueurs</button>
            <button class="btn-danger" onclick="resetTournamentWithOption(false)">Tout r√©initialiser</button>
            <button class="btn-outline" onclick="closeResetDialog()">Annuler</button>
        </div>
    </div>
    
    <!-- Modal d'historique des √©liminations -->
    <div class="modal" id="eliminationHistoryModal">
        <div class="modal-overlay" onclick="closeEliminationHistory()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Historique des √©liminations</div>
                <div class="modal-description">Liste chronologique des joueurs √©limin√©s durant le tournoi</div>
            </div>
            <div class="modal-body">
                <ul class="elimination-list" id="eliminationList"></ul>
            </div>
            <div class="modal-footer">
                <button onclick="closeEliminationHistory()">Fermer</button>
            </div>
        </div>
    </div>
    
    <!-- Modal des gagnants pr√©c√©dents -->
    <div class="winners-modal" id="winnersPanel">
        <div class="winners-modal-overlay" onclick="toggleWinnersPanel()"></div>
        <div class="winners-modal-content">
            <div class="winners-modal-header">
                <div>
                    <div class="winners-modal-title">
                        <span class="trophy-icon">üèÜ</span> Anciens Gagnants
                    </div>
                    <div class="winners-modal-description">Palmar√®s des vainqueurs des tournois pr√©c√©dents</div>
                </div>
            </div>
            <div class="winners-modal-body">
                <ul class="winners-list" id="winnersList">
                    <li class="no-winners">Aucun gagnant enregistr√©</li>
                </ul>
            </div>
            <div class="winners-modal-footer">
                <button onclick="toggleWinnersPanel()">Fermer</button>
            </div>
        </div>
    </div>
    
    <!-- Confirmation d'annulation de match -->
    <div class="undo-confirm-dialog" id="undoConfirmDialog">
        <div class="undo-confirm-title">
            <span>‚ö†Ô∏è</span> Annuler le r√©sultat du match
        </div>
        <div class="undo-confirm-message" id="undoConfirmMessage">
            √ätes-vous s√ªr de vouloir annuler le r√©sultat de ce match ? Cette action peut avoir des cons√©quences sur les tours suivants.
        </div>
        <div class="undo-confirm-buttons">
            <button class="btn-outline" onclick="closeUndoConfirmDialog()">Annuler</button>
            <button class="btn-warning" id="undoConfirmBtn">Confirmer l'annulation</button>
        </div>
    </div>

    <script>
        // D√©claration des variables globales avec let pour permettre leur r√©assignation
        let players = [];
        let matches = [];
        let eliminated = [];
        let winner = "";
        let tournamentStarted = false;
        let eliminationHistory = [];
        let previousWinners = [];
        let tournamentCompleted = false;

        // Fonction pour sauvegarder les donn√©es dans localStorage
        function saveDataToLocalStorage() {
            const tournamentData = {
                players,
                matches,
                eliminated,
                winner,
                tournamentStarted,
                eliminationHistory,
                previousWinners,
                tournamentCompleted
            };
            localStorage.setItem('tournamentData', JSON.stringify(tournamentData));
        }

        // Fonction pour charger les donn√©es depuis localStorage
        function loadDataFromLocalStorage() {
            const savedData = localStorage.getItem('tournamentData');
            if (savedData) {
                try {
                    const tournamentData = JSON.parse(savedData);
                    players = tournamentData.players || [];
                    matches = tournamentData.matches || [];
                    eliminated = tournamentData.eliminated || [];
                    winner = tournamentData.winner || "";
                    tournamentStarted = tournamentData.tournamentStarted || false;
                    eliminationHistory = tournamentData.eliminationHistory || [];
                    tournamentCompleted = tournamentData.tournamentCompleted || false;
                    
                    // Convertir les dates de cha√Æne en objets Date
                    eliminationHistory.forEach(item => {
                        if (typeof item.time === 'string') {
                            item.time = new Date(item.time);
                        }
                    });

                    previousWinners = tournamentData.previousWinners || [];
                    
                    // Convertir les dates de cha√Æne en objets Date pour les gagnants pr√©c√©dents
                    previousWinners.forEach(item => {
                        if (typeof item.date === 'string') {
                            item.date = new Date(item.date);
                        }
                    });

                    // Mettre √† jour l'affichage des gagnants pr√©c√©dents
                    updateWinnersDisplay();
                    
                    // Mettre √† jour l'interface utilisateur
                    updatePlayersDisplay();
                    document.getElementById('count').innerText = `Joueurs ajout√©s : ${players.length}/16`;
                    
                    // Afficher/masquer les √©l√©ments appropri√©s
                    if (tournamentStarted) {
                        document.getElementById('bracket').style.display = 'flex';
                        document.getElementById('resetButton').style.display = 'block';
                        document.getElementById('launchDraw').style.display = 'none';
                        document.getElementById('addPlayerContainer').style.display = 'none';
                        
                        if (eliminationHistory.length > 0) {
                            document.getElementById('eliminationHistoryBtn').style.display = 'block';
                        }
                        
                        renderBracket();
                    } else {
                        if (players.length === 16) {
                            document.getElementById('addPlayerContainer').style.display = 'none';
                            document.getElementById('launchDraw').style.display = 'block';
                        }
                    }
                    
                    showToast("Donn√©es charg√©es", "Les donn√©es du tournoi pr√©c√©dent ont √©t√© restaur√©es.", "success");
                } catch (error) {
                    console.error("Erreur lors du chargement des donn√©es:", error);
                    // En cas d'erreur, r√©initialiser les donn√©es
                    clearAllData();
                }
            }
        }

        // Initialiser le th√®me
        function initTheme() {
            // V√©rifier si un th√®me est enregistr√© dans localStorage
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme) {
                document.documentElement.className = savedTheme;
            } else {
                // V√©rifier les pr√©f√©rences syst√®me
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    document.documentElement.className = 'dark';
                } else {
                    document.documentElement.className = 'light';
                }
            }
            
            // Mettre √† jour l'ic√¥ne du bouton
            updateThemeToggleIcon();
        }

        // Basculer entre les th√®mes
        function toggleTheme() {
            if (document.documentElement.className === 'light') {
                document.documentElement.className = 'dark';
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.className = 'light';
                localStorage.setItem('theme', 'light');
            }
            
            // Mettre √† jour l'ic√¥ne du bouton
            updateThemeToggleIcon();
        }

        // Mettre √† jour l'ic√¥ne du bouton de th√®me
	function updateThemeToggleIcon() {
    	    const themeToggle = document.getElementById('themeToggle');
    	    if (document.documentElement.className === 'dark') {
        	themeToggle.innerHTML = '<img src="./soleil.png" alt="Soleil" width="20" height="20">';
        	themeToggle.setAttribute('aria-label', 'Passer au th√®me clair');
    	    } else {
        	themeToggle.innerHTML = '<img src="./lune.png" alt="Lune" width="20" height="20">';
        	themeToggle.setAttribute('aria-label', 'Passer au th√®me sombre');
    	    }
	}

        // Initialiser le bracket
        function initBracket() {
            for (let i = 0; i < 4; i++) {
                matches[i] = [];
                for (let j = 0; j < Math.pow(2, 4 - i - 1); j++) {
                    matches[i][j] = { p1: '', p2: '', score1: '', score2: '' };
                }
            }
            renderBracket();
        }

        // Rendre le bracket
        function renderBracket() {
            const bracket = document.getElementById('bracket');
            bracket.innerHTML = '';
            const rounds = ['üéØ Huiti√®mes', 'üèÖ Quarts', 'ü•à Demi-finales', 'üèÜ Finale'];

            for (let i = 0; i < 4; i++) {
                const round = document.createElement('div');
                round.className = 'round';
                
                const roundTitle = document.createElement('h3');
                roundTitle.textContent = rounds[i];
                round.appendChild(roundTitle);
                
                const matchCount = Math.pow(2, 4 - i - 1);
                for (let j = 0; j < matchCount; j++) {
                    const matchWrapper = document.createElement('div');
                    matchWrapper.className = 'match-wrapper';
                    matchWrapper.id = `match-wrapper-${i}-${j}`;
                    
                    const match = document.createElement('div');
                    match.className = 'match';
                    match.id = `match-${i}-${j}`;
                    match.innerHTML = renderMatchButtons(i, j);
                    
                    matchWrapper.appendChild(match);
                    
                    // Ajouter les connecteurs pour les lignes
                    if (i < 3) { // Pas de connecteur pour la finale
                        // Connecteur horizontal vers la droite
                        const horizontalConnector = document.createElement('div');
                        horizontalConnector.className = 'connector connector-horizontal';
                        horizontalConnector.style.top = '50%';
                        matchWrapper.appendChild(horizontalConnector);
                    }
                    
                    // Connecteur vertical pour les matchs qui ne sont pas le dernier de leur round
                    if (j % 2 === 0 && j < matchCount - 1) {
                        const verticalConnector = document.createElement('div');
                        verticalConnector.className = 'connector connector-vertical';
                        verticalConnector.style.top = '100%';
                        verticalConnector.style.height = '2rem';
                        matchWrapper.appendChild(verticalConnector);
                    }
                    
                    round.appendChild(matchWrapper);
                }
                bracket.appendChild(round);
            }
            
            // Ajuster les espacements pour les rounds avec moins de matchs
            adjustBracketSpacing();
        }
        
        // Ajuster les espacements pour que les lignes se connectent correctement
        function adjustBracketSpacing() {
            for (let i = 1; i < 4; i++) { // Commencer au deuxi√®me round (quarts)
                const prevRoundMatchCount = Math.pow(2, 4 - i);
                const currentRoundMatchCount = Math.pow(2, 4 - i - 1);
                
                for (let j = 0; j < currentRoundMatchCount; j++) {
                    const matchWrapper = document.getElementById(`match-wrapper-${i}-${j}`);
                    if (matchWrapper) {
                        // Calculer la hauteur totale que devrait occuper ce match
                        const totalHeight = (prevRoundMatchCount / currentRoundMatchCount) * 4 + 'rem';
                        matchWrapper.style.height = totalHeight;
                        
                        // Centrer le match dans son wrapper
                        const match = matchWrapper.querySelector('.match');
                        if (match) {
                            match.style.position = 'absolute';
                            match.style.top = '50%';
                            match.style.transform = 'translateY(-50%)';
                            match.style.width = 'calc(100% - 1rem)';
                        }
                    }
                }
            }
        }

/* Now update the renderMatchButtons function to improve the score display */
function renderMatchButtons(i, j) {
    const match = matches[i][j];
    const p1HasCheckmark = match.p1 && match.p1.includes(' ‚úì');
    const p2HasCheckmark = match.p2 && match.p2.includes(' ‚úì');
    const p1Name = match.p1 ? match.p1.replace(' ‚úì', '') : '';
    const p2Name = match.p2 ? match.p2.replace(' ‚úì', '') : '';
    
    // V√©rifier si les deux joueurs sont pr√©sents
    const bothPlayersPresent = match.p1 && match.p2;
    const matchCompleted = p1HasCheckmark || p2HasCheckmark;
    
    // Classes et attributs pour le joueur 1
    let p1Classes = 'player-btn';
    let p1Disabled = 'disabled';
    if (match.p1) {
        if (p1HasCheckmark) {
            p1Classes += ' winner';
        } else if (!bothPlayersPresent) {
            p1Classes += ' waiting';
        } else if (!matchCompleted && !tournamentCompleted) {
            p1Disabled = '';
        }
    }
    
    // Classes et attributs pour le joueur 2
    let p2Classes = 'player-btn';
    let p2Disabled = 'disabled';
    if (match.p2) {
        if (p2HasCheckmark) {
            p2Classes += ' winner';
        } else if (!bothPlayersPresent) {
            p2Classes += ' waiting';
        } else if (!matchCompleted && !tournamentCompleted) {
            p2Disabled = '';
        }
    }
    
    // Ajouter le checkmark pour le gagnant
    const p1Display = p1HasCheckmark ? `${p1Name} <span class="checkmark">‚úì</span>` : match.p1;
    const p2Display = p2HasCheckmark ? `${p2Name} <span class="checkmark">‚úì</span>` : match.p2;
    
    const btn1 = match.p1 
        ? `<button class="${p1Classes}" ${p1Disabled} 
            onclick="setWinner(${i}, ${j}, '${p1Name}')">${p1Display}</button>` 
        : `<button class="player-btn" disabled>---</button>`;
        
    const btn2 = match.p2 
        ? `<button class="${p2Classes}" ${p2Disabled} 
            onclick="setWinner(${i}, ${j}, '${p2Name}')">${p2Display}</button>` 
        : `<button class="player-btn" disabled>---</button>`;
    
    let matchHtml = `${btn1}${btn2}`;
    
    // Ajouter un message d'information si un seul joueur est pr√©sent
    if ((match.p1 && !match.p2) || (!match.p1 && match.p2)) {
        matchHtml += `<div class="match-info">En attente du second joueur</div>`;
    }
    
    // Ajouter les champs de score si les deux joueurs sont pr√©sents
    if (bothPlayersPresent) {
        // Si le match est termin√©, afficher les scores dans une bo√Æte de score
        if (matchCompleted) {
            if (match.score1 !== '' || match.score2 !== '') {
                matchHtml += `
                <div class="score-box">
                    <div class="score-box-value">
                        <span>${match.score1 || '0'}</span>
                        <span>-</span>
                        <span>${match.score2 || '0'}</span>
                    </div>
                </div>`;
            }
        } else {
            // Sinon, afficher les champs de saisie de score
            matchHtml += `
            <div class="score-inputs">
                <input type="number" min="0" class="score-input" id="score1-${i}-${j}" 
                    value="${match.score1}" placeholder="0" 
                    onchange="updateScore(${i}, ${j}, 'score1', this.value)">
                <span class="score-separator">-</span>
                <input type="number" min="0" class="score-input" id="score2-${i}-${j}" 
                    value="${match.score2}" placeholder="0" 
                    onchange="updateScore(${i}, ${j}, 'score2', this.value)">
            </div>`;
        }
    }
    
    // Ajouter un bouton d'annulation si le match est termin√© et que le tournoi n'est pas termin√©
    if (matchCompleted && !tournamentCompleted) {
        matchHtml += `<button class="undo-match-btn" onclick="showUndoConfirmDialog(${i}, ${j})">
            <span class="undo-icon">‚Ü∫</span> Annuler ce match
        </button>`;
    }
    
    return matchHtml;
}

// Fix the setWinner function to properly advance players to the next round
function setWinner(roundIndex, matchIndex, winnerName) {
    // V√©rifier si le tournoi est d√©j√† termin√©
    if (tournamentCompleted) {
        showToast("Action impossible", "Le tournoi est d√©j√† termin√© avec un gagnant d√©clar√© !", "error");
        return;
    }
    
    const match = matches[roundIndex][matchIndex];
    
    // V√©rifier si les deux joueurs sont pr√©sents
    if (!match.p1 || !match.p2) {
        showToast("Action impossible", "Impossible de d√©terminer un gagnant tant que les deux joueurs ne sont pas pr√©sents !", "error");
        return;
    }
    
    // Nettoyer les noms des joueurs (enlever les checkmarks s'ils existent)
    const p1Name = match.p1.replace(' ‚úì', '');
    const p2Name = match.p2.replace(' ‚úì', '');
    
    // D√©terminer le perdant
    let loserName = p1Name === winnerName ? p2Name : p1Name;
    
    // Ajouter le perdant √† la liste des √©limin√©s s'il n'y est pas d√©j√†
    if (!eliminated.includes(loserName)) {
        eliminated.push(loserName);
        const playerElement = document.querySelector(`#player-list-${loserName.replace(/\s+/g, '-')} span`);
        if (playerElement) playerElement.classList.add('eliminated');
        
        // Ajouter √† l'historique des √©liminations
        const roundNames = ["Huiti√®mes", "Quarts", "Demi-finales", "Finale"];
        eliminationHistory.push({
            winner: winnerName,
            loser: loserName,
            round: roundIndex,
            roundName: roundNames[roundIndex],
            time: new Date()
        });
        
        // Afficher le bouton d'historique des √©liminations s'il n'est pas d√©j√† visible
        document.getElementById('eliminationHistoryBtn').style.display = 'block';
        
        showToast(`${loserName} √©limin√© !`, `${winnerName} remporte le match et avance au prochain tour.`, "success");
    }

    // Marquer le match actuel comme termin√©
    if (p1Name === winnerName) {
        matches[roundIndex][matchIndex].p1 = winnerName + ' ‚úì';
        matches[roundIndex][matchIndex].p2 = loserName;
    } else {
        matches[roundIndex][matchIndex].p2 = winnerName + ' ‚úì';
        matches[roundIndex][matchIndex].p1 = loserName;
    }
    
    const nextRound = roundIndex + 1;
    const nextMatchIndex = Math.floor(matchIndex / 2);
    
    // Faire avancer le gagnant au prochain tour
    if (nextRound < 4) {
        const nextMatch = matches[nextRound][nextMatchIndex];
        
        // D√©terminer si le joueur doit √™tre plac√© en position p1 ou p2
        // Si le match actuel a un index pair, le gagnant va en p1, sinon en p2
        if (matchIndex % 2 === 0) {
            nextMatch.p1 = winnerName;
            nextMatch.score1 = '';
        } else {
            nextMatch.p2 = winnerName;
            nextMatch.score2 = '';
        }
        
        renderBracket();
    } else {
        // C'est la finale, nous avons un gagnant du tournoi
        winner = winnerName;
        tournamentCompleted = true; // Marquer le tournoi comme termin√©
        showVictoryMessage(winnerName);
    }
    
    // Sauvegarder les donn√©es
    saveDataToLocalStorage();
}

        // Ajouter un joueur
        function addPlayer() {
            const nameInput = document.getElementById('playerName');
            const name = nameInput.value.trim();
            
            // V√©rifier si le nom est vide
            if (!name) {
                showToast("Nom invalide", "Veuillez entrer un nom de joueur valide.", "error");
                return;
            }
            
            // V√©rifier si le joueur existe d√©j√† (insensible √† la casse)
            const playerExists = players.some(player => 
                player.toLowerCase() === name.toLowerCase()
            );
            
            if (playerExists) {
                showToast("Joueur d√©j√† inscrit", "Ce joueur est d√©j√† inscrit au tournoi !", "error");
                // Mettre en surbrillance le champ de saisie
                nameInput.focus();
                nameInput.classList.add('input-error');
                // Retirer la classe apr√®s un d√©lai
                setTimeout(() => {
                    nameInput.classList.remove('input-error');
                }, 2000);
                return;
            }
            
            // Ajouter le joueur si la limite n'est pas atteinte
            if (players.length < 16) {
                players.push(name);
                nameInput.value = '';
                document.getElementById('count').innerText = `Joueurs ajout√©s : ${players.length}/16`;
                updatePlayersDisplay();
                
                // Sauvegarder les donn√©es
                saveDataToLocalStorage();
                
                // V√©rifier si on a atteint 16 joueurs
                if (players.length === 16) {
                    // Cacher le conteneur d'ajout de joueurs
                    document.getElementById('addPlayerContainer').style.display = 'none';
                    // Afficher le bouton de tirage
                    document.getElementById('launchDraw').style.display = 'block';
                }
                
                showToast("Joueur ajout√©", `${name} a √©t√© ajout√© au tournoi.`, "success");
            } else if (players.length >= 16) {
                showToast("Limite atteinte", "Le tournoi est limit√© √† 16 joueurs !", "error");
            }
        }

        // Retirer un joueur
        function removePlayer(index) {
            // Ne pas permettre de retirer des joueurs une fois le tournoi commenc√©
            if (tournamentStarted) {
                showToast("Action impossible", "Impossible de retirer un joueur une fois le tournoi commenc√© !", "error");
                return;
            }
            
            const playerName = players[index];
            players.splice(index, 1);
            document.getElementById('count').innerText = `Joueurs ajout√©s : ${players.length}/16`;
            updatePlayersDisplay();
            
            // Sauvegarder les donn√©es
            saveDataToLocalStorage();
            
            // Si on avait 16 joueurs et qu'on en retire un, r√©afficher le conteneur d'ajout
            if (players.length < 16) {
                document.getElementById('addPlayerContainer').style.display = 'block';
                document.getElementById('launchDraw').style.display = 'none';
            }
            
            showToast("Joueur retir√©", `${playerName} a √©t√© retir√© du tournoi.`, "success");
        }

        // Mettre √† jour l'affichage des joueurs
        function updatePlayersDisplay() {
            const ul = document.getElementById('playersDisplay');
            ul.innerHTML = '';
            players.forEach((player, index) => {
                const li = document.createElement('li');
                li.id = `player-list-${player.replace(/\s+/g, '-')} `;
                
                const playerSpan = document.createElement('span');
                playerSpan.textContent = player;
                if (eliminated.includes(player)) {
                    playerSpan.classList.add('eliminated');
                }
                
                const removeButton = document.createElement('button');
                removeButton.innerHTML = '<img src="./croix.png" alt="Supprimer" width="16" height="16">';
                removeButton.className = 'remove-btn';
                removeButton.title = 'Retirer ce joueur';
                removeButton.onclick = function() { removePlayer(index); };
                
                // D√©sactiver le bouton de suppression si le tournoi a commenc√©
                if (tournamentStarted) {
                    removeButton.disabled = true;
                    removeButton.style.opacity = '0.5';
                    removeButton.style.cursor = 'not-allowed';
                }
                
                const playerItem = document.createElement('div');
                playerItem.className = 'player-item';
                playerItem.appendChild(playerSpan);
                playerItem.appendChild(removeButton);
                
                li.appendChild(playerItem);
                ul.appendChild(li);
            });
        }

        // Mettre √† jour l'affichage des gagnants pr√©c√©dents
        function updateWinnersDisplay() {
            const winnersList = document.getElementById('winnersList');
            winnersList.innerHTML = '';
            
            if (previousWinners.length > 0) {
                previousWinners.sort((a, b) => b.date - a.date); // Trier par date d√©croissante
                
                previousWinners.forEach(winner => {
                    const li = document.createElement('li');
                    li.className = 'winner-item';
                    
                    const trophy = document.createElement('div');
                    trophy.className = 'winner-trophy';
                    trophy.textContent = 'üèÜ';
                    
                    const info = document.createElement('div');
                    info.className = 'winner-info';
                    
                    const name = document.createElement('div');
                    name.className = 'winner-name';
                    name.textContent = winner.name;
                    
                    const date = document.createElement('div');
                    date.className = 'winner-date';
                    date.textContent = winner.date.toLocaleDateString();
                    
                    info.appendChild(name);
                    info.appendChild(date);
                    
                    li.appendChild(trophy);
                    li.appendChild(info);
                    
                    winnersList.appendChild(li);
                });
            } else {
                const noWinners = document.createElement('li');
                noWinners.className = 'no-winners';
                noWinners.textContent = 'Aucun gagnant enregistr√©';
                winnersList.appendChild(noWinners);
            }
        }

        // Lancer le tirage
        function launchDraw() {
            tournamentStarted = true;
            shufflePlayers();
            placePlayersRandomly();
            document.getElementById('bracket').style.display = 'flex';
            document.getElementById('launchDraw').style.display = 'none';
            document.getElementById('resetButton').style.display = 'block';
            
            // Mettre √† jour l'affichage pour d√©sactiver les boutons de suppression
            updatePlayersDisplay();
            
            // Sauvegarder les donn√©es
            saveDataToLocalStorage();
            
            showToast("Tournoi lanc√© !", "Le tirage au sort a √©t√© effectu√©. Que le meilleur gagne !", "success");
        }

        // M√©langer les joueurs
        function shufflePlayers() {
            for (let i = players.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [players[i], players[j]] = [players[j], players[i]];
            }
        }

        // Placer les joueurs al√©atoirement
        function placePlayersRandomly() {
            for (let i = 0; i < players.length; i++) {
                const matchIndex = Math.floor(i / 2);
                if (i % 2 === 0) {
                    matches[0][matchIndex].p1 = players[i];
                    matches[0][matchIndex].score1 = '';
                } else {
                    matches[0][matchIndex].p2 = players[i];
                    matches[0][matchIndex].score2 = '';
                }
            }
            renderBracket();
        }

        // Modifier la fonction setWinner pour que les scores n'influencent pas le vainqueur
        function setWinner(roundIndex, matchIndex, winnerName) {
            // V√©rifier si le tournoi est d√©j√† termin√©
            if (tournamentCompleted) {
                showToast("Action impossible", "Le tournoi est d√©j√† termin√© avec un gagnant d√©clar√© !", "error");
                return;
            }
            
            const match = matches[roundIndex][matchIndex];
            
            // V√©rifier si les deux joueurs sont pr√©sents
            if (!match.p1 || !match.p2) {
                showToast("Action impossible", "Impossible de d√©terminer un gagnant tant que les deux joueurs ne sont pas pr√©sents !", "error");
                return;
            }
            
            // Nettoyer les noms des joueurs (enlever les checkmarks s'ils existent)
            const p1Name = match.p1.replace(' ‚úì', '');
            const p2Name = match.p2.replace(' ‚úì', '');
            
            // D√©terminer le perdant
            let loserName = p1Name === winnerName ? p2Name : p1Name;
            
            // Ajouter le perdant √† la liste des √©limin√©s s'il n'y est pas d√©j√†
            if (!eliminated.includes(loserName)) {
                eliminated.push(loserName);
                const playerElement = document.querySelector(`#player-list-${loserName.replace(/\s+/g, '-')} span`);
                if (playerElement) playerElement.classList.add('eliminated');
                
                // Ajouter √† l'historique des √©liminations
                const roundNames = ["Huiti√®mes", "Quarts", "Demi-finales", "Finale"];
                eliminationHistory.push({
                    winner: winnerName,
                    loser: loserName,
                    round: roundIndex,
                    roundName: roundNames[roundIndex],
                    time: new Date()
                });
                
                // Afficher le bouton d'historique des √©liminations s'il n'est pas d√©j√† visible
                document.getElementById('eliminationHistoryBtn').style.display = 'block';
                
                showToast(`${loserName} √©limin√© !`, `${winnerName} remporte le match et avance au prochain tour.`, "success");
            }

            // Marquer le match actuel comme termin√©
            if (p1Name === winnerName) {
                matches[roundIndex][matchIndex].p1 = winnerName + ' ‚úì';
                matches[roundIndex][matchIndex].p2 = loserName;
            } else {
                matches[roundIndex][matchIndex].p2 = winnerName + ' ‚úì';
                matches[roundIndex][matchIndex].p1 = loserName;
            }
            
            // Conserver les scores existants (ne pas les r√©initialiser)
            // Les scores sont maintenant purement informatifs
            
            const nextRound = roundIndex + 1;
            const nextMatchIndex = Math.floor(matchIndex / 2);
            
            // Faire avancer le gagnant au prochain tour
            if (nextRound < 4) {
                const nextMatch = matches[nextRound][nextMatchIndex];
                
                // D√©terminer si le joueur doit √™tre plac√© en position p1 ou p2
                // Si le match actuel a un index pair, le gagnant va en p1, sinon en p2
                if (matchIndex % 2 === 0) {
                    nextMatch.p1 = winnerName;
                    // Ne pas r√©initialiser le score1, juste le d√©finir s'il n'existe pas
                    if (nextMatch.score1 === undefined) nextMatch.score1 = '';
                } else {
                    nextMatch.p2 = winnerName;
                    // Ne pas r√©initialiser le score2, juste le d√©finir s'il n'existe pas
                    if (nextMatch.score2 === undefined) nextMatch.score2 = '';
                }
                
                renderBracket();
            } else {
                // C'est la finale, nous avons un gagnant du tournoi
                winner = winnerName;
                tournamentCompleted = true; // Marquer le tournoi comme termin√©
                showVictoryMessage(winnerName);
            }
            
            // Sauvegarder les donn√©es
            saveDataToLocalStorage();
        }

        // Ajouter une note explicative dans la fonction renderMatchButtons
        function renderMatchButtons(i, j) {
            const match = matches[i][j];
            const p1HasCheckmark = match.p1 && match.p1.includes(' ‚úì');
            const p2HasCheckmark = match.p2 && match.p2.includes(' ‚úì');
            const p1Name = match.p1 ? match.p1.replace(' ‚úì', '') : '';
            const p2Name = match.p2 ? match.p2.replace(' ‚úì', '') : '';
            
            // V√©rifier si les deux joueurs sont pr√©sents
            const bothPlayersPresent = match.p1 && match.p2;
            const matchCompleted = p1HasCheckmark || p2HasCheckmark;
            
            // Classes et attributs pour le joueur 1
            let p1Classes = 'player-btn';
            let p1Disabled = 'disabled';
            if (match.p1) {
                if (p1HasCheckmark) {
                    p1Classes += ' winner';
                } else if (!bothPlayersPresent) {
                    p1Classes += ' waiting';
                } else if (!matchCompleted && !tournamentCompleted) {
                    p1Disabled = '';
                }
            }
            
            // Classes et attributs pour le joueur 2
            let p2Classes = 'player-btn';
            let p2Disabled = 'disabled';
            if (match.p2) {
                if (p2HasCheckmark) {
                    p2Classes += ' winner';
                } else if (!bothPlayersPresent) {
                    p2Classes += ' waiting';
                } else if (!matchCompleted && !tournamentCompleted) {
                    p2Disabled = '';
                }
            }
            
            // Ajouter le checkmark pour le gagnant
            const p1Display = p1HasCheckmark ? `${p1Name} <span class="checkmark">‚úì</span>` : match.p1;
            const p2Display = p2HasCheckmark ? `${p2Name} <span class="checkmark">‚úì</span>` : match.p2;
            
            const btn1 = match.p1 
                ? `<button class="${p1Classes}" ${p1Disabled} 
                    onclick="setWinner(${i}, ${j}, '${p1Name}')">${p1Display}</button>` 
                : `<button class="player-btn" disabled>---</button>`;
                
            const btn2 = match.p2 
                ? `<button class="${p2Classes}" ${p2Disabled} 
                    onclick="setWinner(${i}, ${j}, '${p2Name}')">${p2Display}</button>` 
                : `<button class="player-btn" disabled>---</button>`;
            
            let matchHtml = `${btn1}${btn2}`;
            
            // Ajouter un message d'information si un seul joueur est pr√©sent
            if ((match.p1 && !match.p2) || (!match.p1 && match.p2)) {
                matchHtml += `<div class="match-info">En attente du second joueur</div>`;
            }
            
            // Ajouter les champs de score si les deux joueurs sont pr√©sents
            if (bothPlayersPresent) {
                // Si le match est termin√©, afficher les scores dans une bo√Æte de score
                if (matchCompleted) {
                    if (match.score1 !== '' || match.score2 !== '') {
                        matchHtml += `
                        <div class="score-box">
                            <div class="score-box-value">
                                <span>${match.score1 || '0'}</span>
                                <span>-</span>
                                <span>${match.score2 || '0'}</span>
                            </div>
                        </div>`;
                    }
                } else {
                    // Sinon, afficher les champs de saisie de score
                    matchHtml += `
                    <div class="score-inputs">
                        <input type="number" min="0" class="score-input" id="score1-${i}-${j}" 
                            value="${match.score1 || ''}" placeholder="0" 
                            onchange="updateScore(${i}, ${j}, 'score1', this.value)">
                        <span class="score-separator">-</span>
                        <input type="number" min="0" class="score-input" id="score2-${i}-${j}" 
                            value="${match.score2 || ''}" placeholder="0" 
                            onchange="updateScore(${i}, ${j}, 'score2', this.value)">
                    </div>
                    <div class="score-note">Les scores sont informatifs uniquement</div>`;
                }
            }
            
            // Ajouter un bouton d'annulation si le match est termin√© et que le tournoi n'est pas termin√©
            if (matchCompleted && !tournamentCompleted) {
                matchHtml += `<button class="undo-match-btn" onclick="showUndoConfirmDialog(${i}, ${j})">
                    <span class="undo-icon">‚Ü∫</span> Annuler ce match
                </button>`;
            }
            
            return matchHtml;
        }

        // Afficher le message de victoire
        function showVictoryMessage(winnerName) {
            document.getElementById('winnerText').innerHTML = `üèÜ F√©licitations <strong>${winnerName}</strong>, grand gagnant du tournoi ! üéâ`;
            document.getElementById('victoryMessage').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }

        // Fermer le message de victoire
        function closeVictoryMessage() {
            // Ajouter le gagnant √† la liste des gagnants pr√©c√©dents
            if (winner) {
                previousWinners.push({
                    name: winner,
                    date: new Date()
                });
                
                // Mettre √† jour l'affichage des gagnants
                updateWinnersDisplay();
                
                // Afficher un message indiquant que le tournoi est termin√©
                if (tournamentCompleted) {
                    showToast("Tournoi termin√©", `${winner} est le grand gagnant ! Pour commencer un nouveau tournoi, utilisez le bouton "R√©initialiser le tournoi".`, "success");
                }
                
                // Sauvegarder les donn√©es
                saveDataToLocalStorage();
            }
            
            document.getElementById('victoryMessage').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }

        // Afficher/masquer le panneau des gagnants pr√©c√©dents
        function toggleWinnersPanel() {
            const panel = document.getElementById('winnersPanel');
            const isVisible = panel.style.display === 'block';
            
            if (isVisible) {
                panel.style.display = 'none';
                document.getElementById('overlay').style.display = 'none';
            } else {
                updateWinnersDisplay(); // Mettre √† jour la liste avant d'afficher
                panel.style.display = 'block';
                document.getElementById('overlay').style.display = 'block';
            }
        }

        // Afficher la bo√Æte de dialogue de r√©initialisation
        function showResetConfirmDialog() {
            document.getElementById('resetDialog').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }

        // Fermer la bo√Æte de dialogue de r√©initialisation
        function closeResetDialog() {
            document.getElementById('resetDialog').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }

        // R√©initialiser le tournoi avec option
        function resetTournamentWithOption(keepPlayers) {
            // Sauvegarder la liste des joueurs si demand√©
            const savedPlayers = keepPlayers ? [...players] : [];
            
            // R√©initialiser les variables
            players = keepPlayers ? savedPlayers : [];
            matches = [];
            eliminated = [];
            winner = "";
            tournamentStarted = false;
            tournamentCompleted = false; // R√©initialiser l'√©tat de compl√©tion du tournoi
            
            // R√©initialiser l'interface
            document.getElementById('bracket').style.display = 'none';
            document.getElementById('resetButton').style.display = 'none';
            document.getElementById('launchDraw').style.display = keepPlayers && players.length === 16 ? 'block' : 'none';
            document.getElementById('eliminationHistoryBtn').style.display = eliminationHistory.length > 0 ? 'block' : 'none';
            document.getElementById('count').innerText = `Joueurs ajout√©s : ${players.length}/16`;
            
            // Mettre √† jour l'affichage des joueurs
            updatePlayersDisplay();
            
            // R√©afficher le conteneur d'ajout de joueurs si n√©cessaire
            document.getElementById('addPlayerContainer').style.display = keepPlayers && players.length === 16 ? 'none' : 'block';
            
            // Initialiser un nouveau bracket
            initBracket();
            
            // Sauvegarder les donn√©es
            saveDataToLocalStorage();
            
            showToast("Tournoi r√©initialis√©", keepPlayers ? "Le tournoi a √©t√© r√©initialis√© en conservant la liste des joueurs." : "Toutes les donn√©es du tournoi ont √©t√© effac√©es.", "success");
            
            // Fermer la bo√Æte de dialogue
            closeResetDialog();
        }

        // Effacer toutes les donn√©es
        function clearAllData() {
            if (confirm("√ätes-vous s√ªr de vouloir effacer TOUTES les donn√©es, y compris l'historique des gagnants pr√©c√©dents ?")) {
                localStorage.removeItem('tournamentData');
                location.reload(); // Recharger la page pour repartir de z√©ro
            } else {
                closeConfirmDialog();
            }
        }

        // Afficher une notification toast
        function showToast(title, message, type = "default") {
            const toastContainer = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const toastTitle = document.createElement('div');
            toastTitle.className = 'toast-title';
            toastTitle.textContent = title;
            
            const toastMessage = document.createElement('div');
            toastMessage.className = 'toast-message';
            toastMessage.textContent = message;
            
            toast.appendChild(toastTitle);
            toast.appendChild(toastMessage);
            
            toastContainer.appendChild(toast);
            
            // Supprimer le toast apr√®s 3 secondes
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease-out forwards';
                setTimeout(() => {
                    toastContainer.removeChild(toast);
                }, 300);
            }, 3000);
        }
        
        // Afficher la bo√Æte de dialogue de confirmation
        function showConfirmDialog(title, message, confirmCallback) {
            const dialog = document.getElementById('confirmDialog');
            const titleElement = document.getElementById('confirmDialogTitle');
            const messageElement = document.getElementById('confirmDialogMessage');
            const confirmButton = document.getElementById('confirmDialogConfirmBtn');
            
            titleElement.textContent = title;
            messageElement.textContent = message;
            
            // D√©finir la fonction de rappel pour le bouton de confirmation
            confirmButton.onclick = confirmCallback;
            
            // Afficher l'overlay et la bo√Æte de dialogue
            document.getElementById('overlay').style.display = 'block';
            dialog.style.display = 'block';
        }
        
        // Fermer la bo√Æte de dialogue de confirmation
        function closeConfirmDialog() {
            document.getElementById('confirmDialog').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }
        
        // Afficher l'historique des √©liminations
        function showEliminationHistory() {
            const eliminationList = document.getElementById('eliminationList');
            eliminationList.innerHTML = '';
            
            if (eliminationHistory.length > 0) {
                eliminationHistory.forEach((elimination, index) => {
                    const li = document.createElement('li');
                    li.className = 'elimination-item';
                    
                    const header = document.createElement('div');
                    header.className = 'elimination-header';
                    
                    const eliminatedPlayer = document.createElement('span');
                    eliminatedPlayer.className = 'eliminated-player';
                    eliminatedPlayer.textContent = elimination.loser;
                    
                    const round = document.createElement('span');
                    round.className = 'elimination-round';
                    round.textContent = elimination.roundName;
                    
                    header.appendChild(eliminatedPlayer);
                    header.appendChild(round);
                    
                    const details = document.createElement('div');
                    details.className = 'elimination-details';
                    details.textContent = `√âlimin√© par ${elimination.winner}`;
                    
                    const time = document.createElement('div');
                    time.className = 'elimination-time';
                    time.textContent = elimination.time.toLocaleString();
                    
                    li.appendChild(header);
                    li.appendChild(details);
                    li.appendChild(time);
                    
                    eliminationList.appendChild(li);
                });
            } else {
                const emptyMessage = document.createElement('p');
                emptyMessage.textContent = 'Aucune √©limination enregistr√©e';
                emptyMessage.style.textAlign = 'center';
                emptyMessage.style.color = 'var(--muted-text)';
                eliminationList.appendChild(emptyMessage);
            }
            
            document.getElementById('eliminationHistoryModal').style.display = 'block';
        }
        
        // Fermer l'historique des √©liminations
        function closeEliminationHistory() {
            document.getElementById('eliminationHistoryModal').style.display = 'none';
        }

        // G√©rer l'appui sur Entr√©e dans le champ de saisie
        document.getElementById('playerName').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addPlayer();
            }
        });

        // G√©rer le clic sur l'overlay pour fermer le message de victoire
        document.getElementById('overlay').addEventListener('click', function(e) {
            // Fermer uniquement si on clique directement sur l'overlay
            if (e.target === document.getElementById('overlay')) {
                closeVictoryMessage();
                closeConfirmDialog();
                closeResetDialog();
                closeEliminationHistory();
                toggleWinnersPanel();
                closeUndoConfirmDialog();
            }
        });

        // Ajouter l'√©v√©nement de clic pour le bouton de th√®me
        document.getElementById('themeToggle').addEventListener('click', toggleTheme);

        // Initialiser le th√®me et le bracket au chargement
        document.addEventListener('DOMContentLoaded', function() {
            initTheme();
            initBracket();
            loadDataFromLocalStorage();
            updateWinnersDisplay();
        });

        // Initialiser le th√®me imm√©diatement pour √©viter un flash de th√®me incorrect
        initTheme();
        // Initialiser le bracket au chargement
        initBracket();

        // Fermer la bo√Æte de dialogue d'annulation de match
        function closeUndoConfirmDialog() {
            document.getElementById('undoConfirmDialog').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
        }

        // Mettre √† jour le score d'un match
        function updateScore(roundIndex, matchIndex, scoreType, scoreValue) {
            matches[roundIndex][matchIndex][scoreType] = scoreValue;
            saveDataToLocalStorage();
            renderBracket();
        }

        // Afficher la bo√Æte de dialogue de confirmation d'annulation de match
        function showUndoConfirmDialog(roundIndex, matchIndex) {
            const match = matches[roundIndex][matchIndex];
            
            // Obtenir les noms des joueurs sans les checkmarks
            const p1Name = match.p1.replace(' ‚úì', '');
            const p2Name = match.p2.replace(' ‚úì', '');
            
            // D√©terminer le gagnant et le perdant
            const winnerName = match.p1.includes(' ‚úì') ? p1Name : p2Name;
            const loserName = match.p1.includes(' ‚úì') ? p2Name : p1Name;
            
            // D√©finir le message de confirmation
            document.getElementById('undoConfirmMessage').innerHTML = 
                `√ätes-vous s√ªr de vouloir annuler le r√©sultat de ce match entre <strong>${p1Name}</strong> et <strong>${p2Name}</strong> ?<br><br>` +
                `<strong>${winnerName}</strong> ne sera plus consid√©r√© comme le vainqueur et <strong>${loserName}</strong> sera retir√© de la liste des √©limin√©s.`;
            
            // Configurer le bouton de confirmation pour appeler undoMatch avec les bons param√®tres
            document.getElementById('undoConfirmBtn').onclick = function() {
                undoMatch(roundIndex, matchIndex);
                closeUndoConfirmDialog();
            };
            
            // Afficher la bo√Æte de dialogue
            document.getElementById('undoConfirmDialog').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
        }

        // Fonction pour annuler un match
        function undoMatch(roundIndex, matchIndex) {
            const match = matches[roundIndex][matchIndex];
            
            // Obtenir les noms des joueurs sans les checkmarks
            const p1Name = match.p1.replace(' ‚úì', '');
            const p2Name = match.p2.replace(' ‚úì', '');
            
            // D√©terminer le gagnant et le perdant
            const winnerName = match.p1.includes(' ‚úì') ? p1Name : p2Name;
            const loserName = match.p1.includes(' ‚úì') ? p2Name : p1Name;
            
            // Retirer le checkmark du gagnant
            match.p1 = p1Name;
            match.p2 = p2Name;
            
            // Retirer le perdant de la liste des √©limin√©s
            const eliminatedIndex = eliminated.indexOf(loserName);
            if (eliminatedIndex !== -1) {
                eliminated.splice(eliminatedIndex, 1);
            }
            
            // Retirer de l'historique des √©liminations
            eliminationHistory = eliminationHistory.filter(item => 
                !(item.winner === winnerName && item.loser === loserName && item.round === roundIndex)
            );
            
            // Mettre √† jour l'affichage des joueurs pour retirer la classe eliminated
            const playerElement = document.querySelector(`#player-list-${loserName.replace(/\s+/g, '-')} span`);
            if (playerElement) playerElement.classList.remove('eliminated');
            
            // V√©rifier si nous devons retirer le joueur des tours suivants
            if (roundIndex < 3) { // Pas la finale
                const nextRound = roundIndex + 1;
                const nextMatchIndex = Math.floor(matchIndex / 2);
                const nextMatch = matches[nextRound][nextMatchIndex];
                
                // D√©terminer si le joueur √©tait en position p1 ou p2 dans le match suivant
                if ((matchIndex % 2 === 0 && nextMatch.p1 === winnerName) || 
                    (matchIndex % 2 === 1 && nextMatch.p2 === winnerName)) {
                    
                    // Retirer le joueur du match suivant
                    if (matchIndex % 2 === 0) {
                        nextMatch.p1 = '';
                        nextMatch.score1 = '';
                    } else {
                        nextMatch.p2 = '';
                        nextMatch.score2 = '';
                    }
                    
                    // Si le match suivant a d√©j√† un gagnant, annuler r√©cursivement ce match aussi
                    if (nextMatch.p1.includes(' ‚úì') || nextMatch.p2.includes(' ‚úì')) {
                        undoMatch(nextRound, nextMatchIndex);
                    }
                }
            } else {
                // Si c'√©tait la finale, r√©initialiser le gagnant et le drapeau tournamentCompleted
                if (winner === winnerName) {
                    winner = "";
                    tournamentCompleted = false;
                }
            }
            
            // Mettre √† jour l'affichage du bracket
            renderBracket();
            
            // Sauvegarder les donn√©es
            saveDataToLocalStorage();
            
            // Afficher un message de succ√®s
            showToast("Match annul√©", `Le r√©sultat du match entre ${p1Name} et ${p2Name} a √©t√© annul√©.`, "success");
        }
    </script>

</body>
</html>
